<div class="card-container">
  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && cards.length === 0" class="loading-state">
    <p>Finding matches for you...</p>
  </div>

  <!-- LEFT BUTTON (Pass) -->
  <button class="swipe-btn left" (click)="swipe('left')" [disabled]="cards.length === 0 || isAnimating"
    title="Pass (← arrow key)">
    ❌
  </button>

  <!-- RIGHT BUTTON (Like) -->
  <button class="swipe-btn right" (click)="swipe('right')" [disabled]="cards.length === 0 || isAnimating"
    title="Like (→ arrow key)">
    <img src="/heart.png" alt="Like" class="heart-icon">
  </button>

  <div class="card-stack">
    <div *ngFor="let card of cards; let i = index" class="card" [ngClass]="{
        'active': i === cards.length - 1,
        'swipeleft': i === cards.length - 1 && animationState === 'swipeleft',
        'swiperight': i === cards.length - 1 && animationState === 'swiperight'
      }" [style.zIndex]="i" [style.transform]="
        'scale(' + (1 - (cards.length - 1 - i) * 0.05) + ')' +
        ' translateY(' + ((cards.length - 1 - i) * -10) + 'px)'
      ">
      <!-- Photo Carousel -->
      <div class="card-image-container" *ngIf="card.photos && card.photos.length > 0">
        <img [src]="getImageUrl(getCurrentPhoto(card))" [alt]="card.firstName + ' ' + card.lastName"
          class="card-image" (error)="onImageError($event)" />

        <!-- Photo Navigation Arrows (only show if multiple photos) -->
        <div class="photo-navigation" *ngIf="card.photos.length > 1">
          <button class="photo-nav-btn prev" (click)="previousPhoto(); $event.stopPropagation()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
          <button class="photo-nav-btn next" (click)="nextPhoto(); $event.stopPropagation()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
        </div>

        <!-- Photo Indicators (only show if multiple photos) -->
        <div class="photo-indicators" *ngIf="card.photos.length > 1">
          <span *ngFor="let photo of card.photos; let idx = index" class="photo-indicator"
            [class.active]="idx === (card.currentPhotoIndex || 0)" (click)="goToPhoto(idx); $event.stopPropagation()">
          </span>
        </div>
      </div>

      <div *ngIf="!card.photos || card.photos.length === 0" class="no-photo">
        <p>No photos</p>
      </div>

      <!-- Card Info -->
      <div class="card-info">
        <div class="card-header">
          <h3 class="card-name">{{ card.firstName }} {{ card.lastName }}<span class="card-age">, {{ card.age }}</span>
          </h3>
          <div class="card-details">
            <span *ngIf="card.height" class="detail-badge">
              <svg class="detail-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L12 22M8 6L12 2L16 6M8 18L12 22L16 18" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              {{ card.height }} cm
            </span>
            <span *ngIf="card.location" class="detail-badge">
              <svg class="detail-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
                  fill="currentColor" />
              </svg>
              {{ card.location }}
            </span>
          </div>
        </div>

        <div *ngIf="card.bio" class="card-bio">
          {{ card.bio }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Match Modal -->
<app-match-modal *ngIf="showMatchModal && matchedUser" [matchedUser]="matchedUser" [currentUserPhoto]="currentUserPhoto"
  (close)="closeMatchModal()" (sendMessage)="handleSendMessage($event)"></app-match-modal>
