<div class="chat-wrapper">
  <!-- Error Alert -->
  <div *ngIf="error" class="error-banner">
    {{ error }}
  </div>

  <!-- Contacts Sidebar -->
  <div class="contacts-sidebar">
    <div class="sidebar-header">
      <h1>Messages</h1>
    </div>

    <div class="contacts-list">
      <div *ngIf="contacts.length === 0 && !isLoading" class="no-contacts-message">
        <p>No matches yet!</p>
        <small>Start swiping to find your matches</small>
      </div>

      <div *ngIf="isLoading" class="loading-state">
        <p>Loading your matches...</p>
      </div>

      <div
        *ngFor="let contact of contacts"
        class="contact-card"
        [class.active]="selectedContact?.id === contact.id"
        [class.unread]="contact.unreadCount > 0"
        (click)="selectContact(contact)"
      >
        <div class="contact-avatar">
          <img
            *ngIf="contact.profilePhoto"
            [src]="contact.profilePhoto"
            [alt]="contact.firstName + ' ' + contact.lastName"
          />
          <span *ngIf="!contact.profilePhoto">
            {{ getInitials(contact.firstName, contact.lastName) }}
          </span>
          <div *ngIf="contact.isOnline" class="online-indicator"></div>
        </div>

        <div class="contact-info">
          <div class="contact-top">
            <span class="contact-name">
              {{ contact.firstName }} {{ contact.lastName }}
            </span>
            <span class="contact-time" *ngIf="contact.lastMessage && contact.lastMessage.timestamp">
              {{ formatTime(contact.lastMessage.timestamp) }}
            </span>
          </div>
          <div class="contact-bottom">
            <span class="last-message">
              {{ contact.lastMessage?.text || 'No messages yet' }}
            </span>
            <span *ngIf="contact.unreadCount > 0" class="unread-badge">
              {{ contact.unreadCount }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Area -->
  <div class="chat-area">
    <ng-container *ngIf="selectedContact; else noSelection">
      <!-- Chat Header -->
      <div class="chat-header">
        <div class="chat-header-left">
          <div class="contact-avatar-large">
            <img
              *ngIf="selectedContact.profilePhoto"
              [src]="selectedContact.profilePhoto"
              [alt]="selectedContact.firstName + ' ' + selectedContact.lastName"
            />
            <span *ngIf="!selectedContact.profilePhoto">
              {{ getInitials(selectedContact.firstName, selectedContact.lastName) }}
            </span>
            <div *ngIf="selectedContact.isOnline" class="online-indicator"></div>
          </div>
          <div class="contact-details">
            <h2>{{ selectedContact.firstName }} {{ selectedContact.lastName }}</h2>
            <p class="status">{{ selectedContact.isOnline ? 'Online' : 'Offline' }}</p>
          </div>
        </div>
      </div>

      <!-- Messages Area -->
      <div class="messages-area">
        <div *ngIf="isLoading" class="loading-spinner">
          Loading messages...
        </div>
        
        <div
          *ngFor="let message of messages"
          class="message-bubble"
          [class.sent]="isCurrentUserMessage(message)"
          [class.received]="!isCurrentUserMessage(message)"
        >
          <div class="message-text">{{ message.text }}</div>
          <div class="message-time">{{ formatMessageTime(message.timestamp) }}</div>
        </div>
        
        <div *ngIf="messages.length === 0 && !isLoading" class="no-messages">
          No messages yet. Start a conversation!
        </div>

        <div #messagesEnd></div>
      </div>

      <!-- Message Input -->
      <div class="message-input-area">
        <input
          type="text"
          placeholder="Type a message..."
          [(ngModel)]="newMessage"
          (keypress)="onKeyPress($event)"
          class="message-input"
          [disabled]="isLoading"
        />
        <button
          type="button"
          class="send-button"
          [disabled]="!newMessage.trim() || isLoading"
          (click)="sendMessage()"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path
              d="M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>
    </ng-container>

    <ng-template #noSelection>
      <div class="no-chat-selected">
        <p>Select a conversation to start messaging</p>
      </div>
    </ng-template>
  </div>
</div>
